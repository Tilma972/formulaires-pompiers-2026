<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Devenez Prospecteur | Calendrier 2026 Sapeurs-Pompiers</title>
  <style>
    :root {
      --primary: #e63946;
      --secondary: #1d3557;
      --light: #f1faee;
      --accent: #457b9d;
      --white: #ffffff;
    }
    body {
      font-family: 'Arial', sans-serif;
      line-height: 1.6;
      color: #333;
      background-color: #f5f5f5;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    header {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      border-bottom: 3px solid var(--primary);
      padding-bottom: 15px;
    }
    .logo {
      width: 80px;
      margin-right: 20px;
    }
    h1, h2, h3 {
      color: var(--secondary);
      margin-top: 0;
    }
    h1 {
      margin-bottom: 5px;
      font-size: 24px;
    }
    .subtitle {
      color: var(--primary);
      font-weight: bold;
      margin: 0 0 10px;
    }
    .intro {
      background-color: var(--light);
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 25px;
      border-left: 4px solid var(--accent);
    }
    .steps {
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 25px;
    }
    .steps ol {
      padding-left: 25px;
      margin-bottom: 0;
    }
    .form-section {
      background-color: var(--light);
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      border-left: 4px solid var(--accent);
    }
    .section-title {
      display: inline-block;
      background-color: var(--secondary);
      color: white;
      padding: 8px 15px;
      border-radius: 4px;
      margin-bottom: 15px;
      font-size: 16px;
    }
    .form-row {
      margin-bottom: 15px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input[type="text"], 
    input[type="email"],
    input[type="tel"],
    select,
    textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
      box-sizing: border-box;
    }
    .hidden-section {
      display: none;
    }
    .submit-btn {
      background-color: var(--primary);
      color: white;
      border: none;
      padding: 12px 25px;
      font-size: 18px;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 20px;
      width: 100%;
      font-weight: bold;
      transition: background-color 0.2s;
    }
    .submit-btn:hover {
      background-color: #d1282e;
    }
    .data-policy {
      font-size: 12px;
      color: #666;
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid #eee;
    }
    .confirmation {
      text-align: center;
      padding: 50px 20px;
      background-color: var(--light);
      border-radius: 8px;
      margin-top: 20px;
      display: none;
    }
    .confirmation h2 {
      color: var(--secondary);
    }
    .confirmation-icon {
      font-size: 60px;
      color: var(--primary);
      margin-bottom: 20px;
    }
    .error-message {
      color: var(--primary);
      font-size: 14px;
      display: none;
      margin-top: 5px;
    }
    .hidden {
      display: none;
    }
    @media (max-width: 768px) {
      .container {
        padding: 15px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img src="https://n8n.aspchcrm.fr/files/Logo_pompiers.png" alt="Logo Sapeurs-Pompiers" class="logo">
      <div>
        <h1>Devenez Prospecteur pour le Calendrier 2026</h1>
        <p class="subtitle">Sapeurs-Pompiers de Clermont-l'Hérault</p>
      </div>
    </header>
    
    <div class="intro">
      <h2>Aidez-nous à prospecter des entreprises locales !</h2>
      <p>En tant que prospecteur volontaire, vous contribuerez directement au succès de notre calendrier annuel, une ressource essentielle pour l'Amicale. Votre mission sera simple mais importante : contacter une entreprise locale pour lui proposer un encart publicitaire dans notre calendrier 2026.</p>
    </div>
    
    <div class="steps">
      <h3>Comment ça fonctionne :</h3>
      <ol>
        <li>Sélectionnez une entreprise dans votre commune ou une commune voisine</li>
        <li>Recevez par email toutes les informations nécessaires</li>
        <li>Contactez l'entreprise dans le délai choisi</li>
        <li>Communiquez-nous le résultat via un second formulaire</li>
      </ol>
    </div>
    
    <form id="prospecteur-form" name="prospecteur-form" method="POST" data-netlify="true" netlify-honeypot="bot-field">
      <!-- Champs cachés pour Netlify -->
      <input type="hidden" name="form-name" value="prospecteur-form">
      <p class="hidden">
        <label>Ne pas remplir si vous êtes humain : <input name="bot-field"></label>
      </p>
      
      <div class="form-section">
        <div class="section-title">VOS COORDONNÉES</div>
        <div class="form-row">
          <label for="nom_prenom">Nom et Prénom *</label>
          <input type="text" id="nom_prenom" name="nom_prenom" required>
        </div>
        <div class="form-row">
          <label for="email">Adresse Email *</label>
          <input type="email" id="email" name="email" required>
        </div>
        <div class="form-row">
          <label for="telephone">Téléphone</label>
          <input type="tel" id="telephone" name="telephone">
        </div>
      </div>
      
      <div class="form-section">
        <div class="section-title">ATTRIBUTION DE PROSPECT</div>
        <div class="form-row">
          <label for="entreprise">Choisir une entreprise *</label>
          <select id="entreprise" name="entreprise" required>
            <option value="">-- Sélectionnez une entreprise --</option>
            <!-- Les options seront chargées dynamiquement via JavaScript -->
          </select>
          <div class="error-message" id="entreprise-error">Veuillez sélectionner une entreprise</div>
        </div>
        
        <div class="form-row">
          <input type="checkbox" id="nouvelle_entreprise" name="nouvelle_entreprise">
          <label for="nouvelle_entreprise" style="display: inline;">L'entreprise que je souhaite contacter n'est pas dans la liste</label>
        </div>
        
        <!-- Section conditionnelle pour nouvelle entreprise -->
        <div id="nouvelle-entreprise-section" class="hidden-section">
          <div class="form-row">
            <label for="nom_entreprise">Nom de l'entreprise *</label>
            <input type="text" id="nom_entreprise" name="nom_entreprise">
          </div>
          <div class="form-row">
            <label for="adresse_entreprise">Adresse *</label>
            <input type="text" id="adresse_entreprise" name="adresse_entreprise">
          </div>
          <div class="form-row">
            <label for="commune_entreprise">Commune *</label>
            <input type="text" id="commune_entreprise" name="commune_entreprise">
          </div>
          <div class="form-row">
            <label for="telephone_entreprise">Téléphone</label>
            <input type="tel" id="telephone_entreprise" name="telephone_entreprise">
          </div>
          <div class="form-row">
            <label for="email_entreprise">Email de l'interlocuteur</label>
            <input type="email" id="email_entreprise" name="email_entreprise">
          </div>
        </div>
      </div>
      
      <div class="form-section">
        <div class="section-title">DÉLAI DE PROSPECTION</div>
        <div class="form-row">
          <label for="delai">Temps nécessaire *</label>
          <select id="delai" name="delai" required>
            <option value="3 Jours">3 Jours</option>
            <option value="7 Jours" selected>7 Jours</option>
            <option value="14 Jours">14 Jours</option>
          </select>
        </div>
      </div>
      
      <button type="submit" class="submit-btn">CONFIRMER MA PARTICIPATION</button>
      
      <div class="data-policy">
        En soumettant ce formulaire, vous acceptez que les informations saisies soient utilisées par l'Amicale des Sapeurs-Pompiers de Clermont l'Hérault dans le cadre de votre participation à la campagne de prospection pour le calendrier 2026.
      </div>
    </form>
    
    <div class="confirmation" id="confirmation">
      <div class="confirmation-icon">✓</div>
      <h2>Participation confirmée !</h2>
      <p>Merci de votre soutien aux Sapeurs-Pompiers de Clermont l'Hérault.</p>
      <p>Vous recevrez prochainement un email avec toutes les informations nécessaires pour contacter l'entreprise.</p>
    </div>
  </div>
  
  <script>
    // Chargement dynamique des entreprises depuis l'API
    document.addEventListener('DOMContentLoaded', function() {
      // Fonction pour charger les entreprises
      const loadEnterprises = async () => {
        try {
          const response = await fetch('https://n8n.aspchcrm.fr/webhook/get-enterprises');
          if (!response.ok) {
            throw new Error('Erreur lors du chargement des entreprises');
          }
          const data = await response.json();
          
          const selectElement = document.getElementById('entreprise');
          
          // Trier les entreprises par commune puis par nom
          data.sort((a, b) => {
            if (a.commune !== b.commune) {
              return a.commune.localeCompare(b.commune);
            }
            return a.nom_entreprise.localeCompare(b.nom_entreprise);
          });
          
          // Grouper par commune
          let currentCommune = '';
          
          data.forEach(enterprise => {
            // Si on change de commune, ajouter un groupe optgroup
            if (enterprise.commune !== currentCommune) {
              currentCommune = enterprise.commune;
              const optgroup = document.createElement('optgroup');
              optgroup.label = currentCommune;
              selectElement.appendChild(optgroup);
            }
            
            // Ajouter l'option dans le dernier optgroup
            const option = document.createElement('option');
            option.value = enterprise.id;
            option.textContent = enterprise.nom_entreprise;
            selectElement.lastChild.appendChild(option);
          });
        } catch (error) {
          console.error('Erreur:', error);
          // Fallback en cas d'erreur - charger quelques entreprises par défaut
          const selectElement = document.getElementById('entreprise');
          const option = document.createElement('option');
          option.value = "error";
          option.textContent = "Erreur de chargement - veuillez réessayer plus tard";
          selectElement.appendChild(option);
        }
      };
      
      // Charger les entreprises
      loadEnterprises();
      
      // Gestion de l'affichage conditionnel
      const checkboxNouvelleEntreprise = document.getElementById('nouvelle_entreprise');
      const sectionNouvelleEntreprise = document.getElementById('nouvelle-entreprise-section');
      const champEntreprise = document.getElementById('entreprise');
      
      checkboxNouvelleEntreprise.addEventListener('change', function() {
        if (this.checked) {
          sectionNouvelleEntreprise.style.display = 'block';
          champEntreprise.required = false;
          document.getElementById('nom_entreprise').required = true;
          document.getElementById('adresse_entreprise').required = true;
          document.getElementById('commune_entreprise').required = true;
        } else {
          sectionNouvelleEntreprise.style.display = 'none';
          champEntreprise.required = true;
          document.getElementById('nom_entreprise').required = false;
          document.getElementById('adresse_entreprise').required = false;
          document.getElementById('commune_entreprise').required = false;
        }
      });
      
      // Gestion de la soumission du formulaire
      const form = document.getElementById('prospecteur-form');
      
      form.addEventListener('submit', async function(event) {
        event.preventDefault();
        
        // Vérifier que le formulaire est valide
        if (!form.checkValidity()) {
          return;
        }
        
        // Collecter les données du formulaire
        const formData = new FormData(form);
        const formObject = {};
        formData.forEach((value, key) => {
          formObject[key] = value;
        });
        
        try {
          // Envoyer les données au webhook n8n
          const response = await fetch('https://n8n.aspchcrm.fr/webhook/prospecteur-inscription', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(formObject)
          });
          
          if (!response.ok) {
            throw new Error('Erreur lors de l\'envoi du formulaire');
          }
          
          // Afficher la confirmation
          document.getElementById('prospecteur-form').style.display = 'none';
          document.getElementById('confirmation').style.display = 'block';
          
          // Scroll vers la confirmation
          document.getElementById('confirmation').scrollIntoView({ behavior: 'smooth' });
        } catch (error) {
          console.error('Erreur:', error);
          
          // Fallback: soumettre via Netlify Forms
          const netlifyForm = document.createElement('form');
          netlifyForm.method = 'POST';
          netlifyForm.action = '/';
          netlifyForm.setAttribute('data-netlify', 'true');
          netlifyForm.setAttribute('name', 'prospecteur-form');
          
          // Ajouter chaque champ au formulaire Netlify
          Object.keys(formObject).forEach(key => {
            if (key !== 'form-name' && key !== 'bot-field') {
              const input = document.createElement('input');
              input.type = 'hidden';
              input.name = key;
              input.value = formObject[key];
              netlifyForm.appendChild(input);
            }
          });
          
          // Ajouter le champ form-name
          const formNameInput = document.createElement('input');
          formNameInput.type = 'hidden';
          formNameInput.name = 'form-name';
          formNameInput.value = 'prospecteur-form';
          netlifyForm.appendChild(formNameInput);
          
          // Ajouter le formulaire au document et le soumettre
          document.body.appendChild(netlifyForm);
          netlifyForm.submit();
        }
      });
    });
  </script>
</body>
</html>